<!-- registro.component.html -->
<div class="registro-container">
  <div class="background-image"></div>
  <div class="modal-registro">
    <div class="registro-card">
      <button class="close-button" (click)="cerrarModal()">‚úñ</button>
      <div class="logo">
        <img src="assets/images/lombritechlogo2.png" alt="LombriTech Logo" class="logo-image">
      </div>

      <h2 class="titulo">
        @if (currentStep === 1) {
          Informaci√≥n Personal
        } @else {
          Cuenta y Contrase√±a
        }
      </h2>
      
      <form [formGroup]="registroForm" (ngSubmit)="onSubmit()">
        @if (currentStep === 1) {
          <div class="step-content">
            <div class="form-group">
              <label for="tipoUsuario">Tipo de usuario</label>
              <select 
                id="tipoUsuario"
                formControlName="tipoUsuario" 
                class="form-select"
                [class.error]="registroForm.get('tipoUsuario')?.invalid && registroForm.get('tipoUsuario')?.touched"
              >
                <option value="" disabled>Selecciona tu tipo de usuario</option>
                <option value="alumno">Alumno</option>
                <option value="investigador">Investigador</option>
              </select>
              @if (registroForm.get('tipoUsuario')?.invalid && registroForm.get('tipoUsuario')?.touched) {
                <div class="error-message">
                  Debes seleccionar un tipo de usuario
                </div>
              }
            </div>

            <div class="form-group">
              <label for="nombre">Nombre</label>
              <input 
                id="nombre"
                type="text" 
                formControlName="nombre" 
                class="form-input"
                [class.error]="registroForm.get('nombre')?.invalid && registroForm.get('nombre')?.touched"
                placeholder="Ingresa tu nombre"
              />
              @if (registroForm.get('nombre')?.invalid && registroForm.get('nombre')?.touched) {
                <div class="error-message">
                  El nombre es requerido
                </div>
              }
            </div>

            <div class="form-group">
              <label for="apellido">Apellido</label>
              <input 
                id="apellido"
                type="text" 
                formControlName="apellido" 
                class="form-input"
                [class.error]="registroForm.get('apellido')?.invalid && registroForm.get('apellido')?.touched"
                placeholder="Apellido"
              />
              @if (registroForm.get('apellido')?.invalid && registroForm.get('apellido')?.touched) {
                <div class="error-message">
                  Los apellidos son requeridos
                </div>
              }
            </div>

            <div class="button-group">
              <button
                type="button"
                class="next-btn"
                [disabled]="!isStep1Valid()"
                [class.disabled]="!isStep1Valid()"
                (click)="nextStep()"
              >
                Continuar ‚Üí
              </button>
            </div>
          </div>
        }

        @if (currentStep === 2) {
          <div class="step-content">
            <div class="form-group">
              <label for="email">Correo electr√≥nico</label>
              <input 
                id="email"
                type="email" 
                formControlName="email" 
                class="form-input"
                [class.error]="registroForm.get('email')?.invalid && registroForm.get('email')?.touched"
                placeholder="tu@email.com"
              />
              @if (registroForm.get('email')?.invalid && registroForm.get('email')?.touched) {
                <div class="error-message">
                  @if (registroForm.get('email')?.errors?.['required']) {
                    <span>El email es requerido</span>
                  }
                  @if (registroForm.get('email')?.errors?.['email']) {
                    <span>Ingresa un email v√°lido</span>
                  }
                </div>
              }
            </div>

            <!-- üöÄ Nuevo campo de usuario_telegram -->
<div class="form-group">
  <label for="usuario_telegram">Usuario de Telegram</label>
  <input 
    id="usuario_telegram"
    type="text"
    formControlName="usuario_telegram"
    class="form-input"
    placeholder="@tu_usuario"
    [class.error]="registroForm.get('usuario_telegram')?.invalid && registroForm.get('usuario_telegram')?.touched"
  />
  @if (registroForm.get('usuario_telegram')?.invalid && registroForm.get('usuario_telegram')?.touched) {
    <div class="error-message">
      El usuario de Telegram es requerido y debe tener m√°ximo 50 caracteres
    </div>
  }
</div>

            <div class="form-group">
              <label for="contrase√±a">Contrase√±a</label>
              <input 
                id="contrase√±a"
                type="password" 
                formControlName="contrase√±a" 
                class="form-input"
                [class.error]="registroForm.get('contrase√±a')?.invalid && registroForm.get('contrase√±a')?.touched"
                placeholder="M√≠nimo 6 caracteres"
              />
              @if (registroForm.get('contrase√±a')?.invalid && registroForm.get('contrase√±a')?.touched) {
                <div class="error-message">
                  @if (registroForm.get('contrase√±a')?.errors?.['required']) {
                    <span>La contrase√±a es requerida</span>
                  }
                  @if (registroForm.get('contrase√±a')?.errors?.['minlength']) {
                    <span>La contrase√±a debe tener al menos 6 caracteres</span>
                  }
                </div>
              }
            </div>

            <div class="form-group">
              <label for="confirmarContrase√±a">Confirmar contrase√±a</label>
              <input 
                id="confirmarContrase√±a"
                type="password" 
                formControlName="confirmarContrase√±a" 
                class="form-input"
                [class.error]="registroForm.get('confirmarContrase√±a')?.invalid && registroForm.get('confirmarContrase√±a')?.touched"
                placeholder="Confirma tu contrase√±a"
              />
              @if (registroForm.get('confirmarContrase√±a')?.invalid && registroForm.get('confirmarContrase√±a')?.touched) {
                <div class="error-message">
                  @if (registroForm.get('confirmarContrase√±a')?.errors?.['required']) {
                    <span>Confirma tu contrase√±a</span>
                  }
                </div>
              }
              @if (registroForm.errors?.['passwordMismatch'] && registroForm.get('confirmarContrase√±a')?.touched) {
                <div class="error-message">
                  Las contrase√±as no coinciden
                </div>
              }
            </div>

            <div class="button-group">
              <button 
                type="submit" 
                class="submit-btn"
                [disabled]="registroForm.invalid || isSubmitting"
                [class.disabled]="registroForm.invalid || isSubmitting"
              >
                @if (isSubmitting) {
                  <span>Registrando...</span>
                } @else {
                  <span>Registrarse</span>
                }
              </button>
              <button 
                type="button" 
                class="back-step-btn"
                (click)="previousStep()"
              >
                ‚Üê Atr√°s
              </button>
            </div>
          </div>
        }
      </form>
    </div>
    
    <app-user-alert
      [isVisible]="showSuccessAlert"
      [message]="'¬°Te has registrado exitosamente!'"
      [buttonText]="'Continuar'"
      (accept)="onAlertAccept()"
      (close)="onAlertClose()">
    </app-user-alert>
    
    <app-user-alert-problem
      [isVisible]="showProblemAlert"
      (accept)="onProblemAlertAccept()"
      (close)="onProblemAlertAccept()"
      mensaje="Ocurri√≥ un error durante el registro.">
    </app-user-alert-problem>
  </div>
</div>